/**
 * BeerProto
 *
 * Another beer format, written in protocol buffer.
 *
 * Copyright (c) 2020 Ross Merrigan
 */
syntax = "proto3";

package beerproto.v1;

import "beerproto/v1/measureable_units.proto";
import "beerproto/v1/packaging_graphic.proto";
import "buf/validate/validate.proto";

message PackagingVesselBase {
  string name = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 3
  ];  
  PackagingVesselUnit type = 2;

  VolumeType vessel_volume = 3;
  int32 vessel_quantity = 4;
  string description = 5;
  repeated PackagingGraphicType graphics = 6;

}

enum PackagingVesselUnit {
  PACKAGING_VESSEL_UNIT_UNSPECIFIED = 0;
  // keg
  PACKAGING_VESSEL_UNIT_KEG = 1;
  // bottle
  PACKAGING_VESSEL_UNIT_BOTTLE = 2;
  // cask
  PACKAGING_VESSEL_UNIT_CASK = 3;
  // tank
  PACKAGING_VESSEL_UNIT_TANK = 4;
  // firkin
  PACKAGING_VESSEL_UNIT_FIRKIN = 5;
  // other
  PACKAGING_VESSEL_UNIT_OTHER = 6;
  // can
  PACKAGING_VESSEL_UNIT_CAN = 7;
}
 
// PackagingVesselType - a per vessel representation of a packaging process
message PackagingVesselType {
  PackagingVesselBase base = 1;
  string id = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.uuid = true
  ];

  string package_date = 3;

  // Process step duration at packaging
  TimeType step_time = 4;

  GravityType start_gravity = 5;
  GravityType end_gravity = 6;

  AcidityType start_ph = 7;
  AcidityType end_ph = 8;

  TemperatureType start_temperature = 9;
  TemperatureType end_temperature = 10;



  // Target carbonation for this vessel (vols or g/L)
  CarbonationType target_carbonation = 11;

  // // Computed / logged residual carbonation before packaging (optional)
  // CarbonationType residual_carbonation = 13;

  // How much extra we're adding (target - residual)
  //CarbonationType additional_carbonation = 14;


  // Optional notes (cask finings, venting, etc.)
  string notes = 12;

  oneof carbonation_step {
    ForceCarbonationStepType force_carbonation = 13;
    PrimingStepType          priming           = 14;
    SpundingStepType         spunding = 15;
    NaturalConditioningStepType  natural_conditioning = 16;
  }
}



message ForceCarbonationStepType {
  // Pressure at which we hold the vessel (e.g. 1.0–2.5 bar)
  PressureType pressure = 1;

  // Duration at that pressure (e.g. 2 days)
  TimeType duration = 2;

  // Optional: temperature explicitly used for force carb
  // (if omitted, you can fall back to start_temperature on the step)
  TemperatureType temperature = 3;
}

message PrimingStepType {
  // What kind of sugar (dextrose, sucrose, DME, etc.)
  PrimingSugarType priming_sugar = 1;

  // Optional: volume of beer this priming addition is intended for
  // (useful if you ever do partial batch priming)
  VolumeType beer_volume = 2;
}


enum PrimingSugarKind {
  PRIMING_SUGAR_KIND_UNSPECIFIED = 0;
  PRIMING_SUGAR_KIND_SUCROSE = 1;
  PRIMING_SUGAR_KIND_DEXTROSE = 2;
  PRIMING_SUGAR_KIND_DME = 3;
  PRIMING_SUGAR_KIND_HONEY = 4;
  PRIMING_SUGAR_KIND_CANDI = 5;
  PRIMING_SUGAR_KIND_SYRUP = 6;
  PRIMING_SUGAR_KIND_OTHER = 7;
}

message PrimingSugarType {
  // General category of priming sugar (dextrose, sucrose, DME, honey, etc.)
  PrimingSugarKind kind = 1;

  // Optional free-text name (e.g. "DME Light", "Grade A Clover Honey")
  string name = 2;

  // Amount of sugar added to the vessel
  MassType mass = 3;

  // Optional color (useful for DME, syrups, dark sugars)
  ColorType color = 4;

  // Optional fermentability as a percentage (0–100)
  // e.g. 100% for dextrose, ~75% for DME, ~95% for honey
  PercentType fermentability = 5;
}

// Spunding – closing the fermenter or keg early to trap naturally
// produced CO₂ using fermentation pressure.
message SpundingStepType {
  // The pressure at which the spunding valve / PRV is set
  // (gauge pressure, e.g. 1.0–1.2 bar for typical lager spunding).
  PressureType pressure = 1;

  // Optional: gravity at which you started spunding
  // (often "I closed it at ~1.020").
  GravityType start_gravity = 2;

  // Optional: any spunding-specific notes
  // (you can still use PackagingVesselStepType.notes for general stuff).
  string notes = 3;

  // Optional: estimated carbonation contributed by spunding phase only.
  CarbonationType additional_carbonation = 4;

}



message NaturalConditioningStepType {

}