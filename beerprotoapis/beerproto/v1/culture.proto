/**
 * BeerProto
 *
 * Another beer format, written in protocol buffer.
 *
 * Copyright (c) 2020 Ross Merrigan
 */
syntax = "proto3";

package beerproto.v1;

import "beerproto/v1/measureable_units.proto";
import "beerproto/v1/timing.proto";
import "buf/validate/validate.proto";

// CultureBase Provides unique properties to identify individual records of a culture.
message CultureBase {
  string name = 1 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.min_len = 3
  ];
  CultureBaseType type = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).enum = {
      not_in: [0]
    }
  ];
  CultureBaseForm form = 3 [
    (buf.validate.field).required = true,
    (buf.validate.field).enum = {
      not_in: [0]
    }
  ];
  string producer = 4;
  string product_id = 5;
}

// CultureInformation collects the attributes of a microbial culture
message CultureInformation {
  CultureBase base = 1 [(buf.validate.field).required = true];
  string id = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.uuid = true
  ];
  // The recommended temperature range of fermentation by the culture producer.
  TemperatureRangeType temperature_range = 3;
  string notes = 4;
  // Recommended styles for a particular culture.
  string best_for = 5;
  CultureInventoryType inventory = 6;
  // The recommended limit of abv by the culture producer before attenuation stops.
  PercentType alcohol_tolerance = 8;
  // A glucoamylase positive culture is capable of producing glucoamylase, the enzyme produced through expression of the diastatic gene, which allows yeast to attenuate dextrins and starches leading to a very low FG. This is positive in some saison/brett yeasts as well as the new gulo hybrid by Omega yeast labs.
  bool glucoamylase = 9;
  CultureBaseType type = 10;
  // Floculation refers to the ability of yeast to aggregate to form large flocs which drop out of suspension.
  QualitativeRangeUnit flocculation = 11;
  PercentRangeType attenuation_range = 12;
  // Maximum number of times to reuse a culture before a new lab source is recommended.
  int32 max_reuse = 13;
  // A POF+ culture is capable of producing phenols, which is a common distinctive property of saison, and brett yeasts.
  bool pof = 14;
  Zymocide zymocide = 15;
}

enum QualitativeRangeUnit {
  QUALITATIVE_RANGE_UNIT_UNSPECIFIED = 0;
  // very low
  QUALITATIVE_RANGE_UNIT_VERY_LOW = 1;
  // low
  QUALITATIVE_RANGE_UNIT_LOW = 2;
  // medium low
  QUALITATIVE_RANGE_UNIT_MEDIUM_LOW = 3;
  // medium
  QUALITATIVE_RANGE_UNIT_MEDIUM = 4;
  // medium high
  QUALITATIVE_RANGE_UNIT_MEDIUM_HIGH = 5;
  // high
  QUALITATIVE_RANGE_UNIT_HIGH = 6;
  // very high
  QUALITATIVE_RANGE_UNIT_VERY_HIGH = 7;
}

// CultureAdditionType collects the attributes of each culture ingredient for use in a recipe
message CultureAdditionType {
  CultureBase base = 1 [(buf.validate.field).required = true];
  string id = 2 [
    (buf.validate.field).required = true,
    (buf.validate.field).string.uuid = true
  ];
  int32 cell_count_billions = 3;
  int32 times_cultured = 4;
  CultureBaseType type = 5;
  // The expected, or measured apparent attenuation for a given culture in a given recipe. In comparison to attenuation range, this is a single value.
  PercentType attenuation = 6;
  // The timing object fully describes the timing of an addition with options for basis on time, gravity, or pH at any process step.
  TimingType timing = 7;

  oneof amount {
    option (buf.validate.oneof).required = true;
    MassType mass = 8;
    UnitType unit = 9;
    VolumeType volume = 10;
  }
}

enum CultureBaseForm {
  CULTURE_BASE_FORM_UNSPECIFIED = 0;
  // liquid
  CULTURE_BASE_FORM_LIQUID = 1;
  // dry
  CULTURE_BASE_FORM_DRY = 2;
  // slant
  CULTURE_BASE_FORM_SLANT = 3;
  // culture
  CULTURE_BASE_FORM_CULTURE = 4;
  // dregs
  CULTURE_BASE_FORM_DREGS = 5;
}

enum CultureBaseType {
  CULTURE_BASE_TYPE_UNSPECIFIED = 0;

  // Yeast
  CULTURE_BASE_TYPE_ALE = 1;
  CULTURE_BASE_TYPE_LAGER = 7;
  CULTURE_BASE_TYPE_KVEIK = 5;
  CULTURE_BASE_TYPE_BRETT = 3;
  CULTURE_BASE_TYPE_CHAMPAGNE = 4;
  CULTURE_BASE_TYPE_WINE = 13;
  CULTURE_BASE_TYPE_NON_SACCHAROMYCES = 14;

  // Bacteria
  CULTURE_BASE_TYPE_LACTO = 6;
  CULTURE_BASE_TYPE_PEDIO = 11;
  CULTURE_BASE_TYPE_MALOLACTIC = 8;
  CULTURE_BASE_TYPE_ACETIC = 15;
  CULTURE_BASE_TYPE_BACTERIA = 2;

  // Mixed / process-driven
  CULTURE_BASE_TYPE_MIXED_CULTURE = 9;
  CULTURE_BASE_TYPE_SPONTANEOUS = 12;
  CULTURE_BASE_TYPE_SCOBY = 17;

  // Other biological agents
  CULTURE_BASE_TYPE_MOLD = 16;

  // Fallback
  CULTURE_BASE_TYPE_OTHER = 10;
}


message CultureInventoryType {
  VolumeType liquid = 1;
  MassType dry = 2;
  VolumeType slant = 3;
  VolumeType culture = 4;
}

// Zymocide, also known as killer yeast properties, is common among wine yeast. There are also some ale and brett yeasts that are immune to some zymocidic properties, these are known as killer neutral
message Zymocide {
  bool no1 = 1;
  bool no2 = 2;
  bool no28 = 3;
  bool klus = 4;
  bool neutral = 5;
}
